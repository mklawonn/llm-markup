<pre class='metadata'>
Title: LLM Markup (LLMPM)
Shortname: llm-markup
Level: 1
Status: ED
Group: LLM Markup Community Group
URL: https://example.org/llm-markup
Editor: [Your Name/Organization]
Abstract: A declarative transformation contract embedded in HTML to govern LLM agent behavior.
Markup Shorthands: markdown yes
</pre>

# Namespaces and Attributes

## The LLM-Intent Namespace

The `llm-intent` namespace defines soft constraints and semantic signals that help the User Agent construct a deterministic context for the LLM. Unlike policy attributes, these do not strictly enforce visibility or mutability by default, but provide metadata that can be targeted by policies.

### The llm-intent-category attribute
Assigns a semantic category to a node, allowing it to be targeted by Global Policy rules or specific LLM instructions.

*   **Syntax:** `llm-intent-category="<string>"`
*   **Purpose:** Provides a stable, semantic label (e.g., "quote", "advertisement", "navigation") independent of CSS classes or visual presentation.

## The LLM-Policy Namespace

The `llm-policy` namespace defines hard constraints that a conforming User Agent MUST enforce. These are split into three primary attributes to govern the flow of information and mutations.

### The llm-policy-input attribute
Governs the flow of data from the DOM to the Language Model (Redaction and Visibility).

*   **`allow` (Initial):** The User Agent MUST include the node and its descendants in the LLM context.
*   **`block`:** The User Agent MUST omit the node and its descendants from the context.
*   **`mask`:** The User Agent MUST preserve the structure but replace text content with placeholders.
*   **`summary`:** The User Agent MUST replace the node's content with a summary before transmission.

### The llm-policy-output attribute
Governs the flow of mutations from the Language Model to the DOM (Enforcement).

*   **`readonly` (Initial):** The User Agent MUST reject all mutations targeting this node.
*   **`mutable`:** The User Agent MAY accept mutations across all layers.
*   **`append-only`:** The User Agent MUST allow insertion of children but reject modification of existing content.
*   **`style-only`:** The User Agent MUST allow modifications to the Presentation Layer (CSS/Classes) only.
*   **`content-only`:** The User Agent MUST allow modifications to the Content Layer (Text) only.

### The llm-policy-memory attribute
Governs the persistence of interaction data (Privacy).

*   **`no-store` (Initial):** The User Agent MUST signal that the content is ephemeral and MUST NOT be used for training or long-term recall.
*   **`persist`:** The User Agent MAY allow long-term retention of the interaction data.

# Global Policy Header

A server MAY provide a global policy via a JSON-encoded payload. This payload defines default behaviors and immutable constraints for the entire document.

## JSON Schema

The global policy is defined as a JSON object. This schema enforces site-wide defaults and specific constraints, such as blocking specific selectors or enforcing co-occurrence dependencies (e.g., preventing a quote from appearing without its citation).

```json
{
  "defaults": {
    "llm-policy-input": "allow|block|mask|summary",
    "llm-policy-output": "readonly|mutable|...",
    "llm-policy-memory": "no-store|persist"
  },
  "constraints": {
    "block-selectors": ["css-selector", "..."],
    "category-rules": {
      "advertisement": { "llm-policy-input": "block" },
      "quote": { "llm-policy-output": "readonly" }
    },
    "dependencies": [
      {
        "trigger": ".pull-quote",
        "requires": ".attribution-context",
        "scope": "input",
        "failure-mode": "omit-trigger"
      }
    ]
  }
}
```

### Constraint Types
*   **`block-selectors`:** Forcibly removes elements matching the CSS selector from the LLM's view.
*   **`category-rules`:** Maps an `llm-intent-category` value (e.g., `advertisement`) to specific policy enforcements (e.g., `block`). This allows semantic control over policy without relying on brittle CSS classes.
*   **`dependencies`:** Enforces co-occurrence of elements to maintain context (e.g., requiring a citation for a quote).

## Precedence and Inheritance

1.  **Constraints:** Constraints defined in the global policy header MUST NOT be overridden by local DOM attributes.
2.  **Local Overrides:** Local attributes (e.g., `llm-policy-output="mutable"`) override the global `defaults` unless a constraint prevents it.
3.  **Inheritance:** Attributes on a node apply to all its descendants unless a descendant specifies its own attribute.
