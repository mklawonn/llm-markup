{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/llm-markup/schemas/global-policy.json",
  "title": "LLM Markup Global Policy Header",
  "description": "Schema for the LLM Markup Global Policy Header defining site-wide constraints and defaults.",
  "type": "object",
  "properties": {
    "defaults": {
      "type": "object",
      "description": "Default attribute values applied to the entire document unless overridden locally.",
      "properties": {
        "llm-policy-input": {
          "type": "array",
          "items": { "enum": ["structure", "text", "attributes", "media", "all", "none"] },
          "default": ["structure", "text", "attributes", "media"]
        },
        "llm-policy-output": {
          "type": "array",
          "items": { "enum": ["readonly", "mutable", "style", "interaction", "layout", "annotation", "content", "append"] },
          "default": ["readonly"]
        },
        "llm-policy-memory": {
          "type": "array",
          "items": { "enum": ["none", "session", "user", "training"] },
          "default": ["none"]
        }
      },
      "additionalProperties": false
    },
    "constraints": {
      "type": "object",
      "description": "Hard constraints that cannot be overridden by local attributes.",
      "properties": {
        "block-selectors": {
          "type": "array",
          "description": "List of CSS selectors that must be forcibly blocked from the LLM input.",
          "items": { "type": "string" }
        },
        "category-rules": {
          "type": "object",
          "description": "Maps 'llm-intent-category' values to policy constraints. These rules override defaults but can be overridden by specific local policy attributes if not strictly enforced.",
          "patternProperties": {
            "^.*$": {
              "type": "object",
              "properties": {
                "llm-policy-input": {
                  "type": "array",
                  "items": { "enum": ["structure", "text", "attributes", "media", "all", "none"] }
                },
                "llm-policy-output": {
                  "type": "array",
                  "items": { "enum": ["readonly", "mutable", "style", "interaction", "layout", "annotation", "content", "append"] }
                },
                "llm-policy-memory": {
                  "type": "array",
                  "items": { "enum": ["none", "session", "user", "training"] }
                }
              },
              "additionalProperties": false
            }
          }
        },
        "dependencies": {
          "type": "array",
          "description": "Rules enforcing co-occurrence of elements in the LLM context. If the 'trigger' element is included, the 'requires' element MUST also be included.",
          "items": {
            "type": "object",
            "properties": {
              "trigger": {
                "type": "string",
                "description": "CSS selector for the element that triggers this dependency."
              },
              "requires": {
                "type": "string",
                "description": "CSS selector for the element that MUST accompany the trigger."
              },
              "scope": {
                "type": "string",
                "enum": ["input", "output", "both"],
                "default": "input",
                "description": "Whether this applies to what the LLM sees (input) or what it generates (output)."
              },
              "failure-mode": {
                "type": "string",
                "enum": ["omit-trigger", "error"],
                "default": "omit-trigger",
                "description": "Action to take if the requirement is not met. 'omit-trigger' removes the triggering element from context; 'error' halts processing."
              }
            },
            "required": ["trigger", "requires"]
          }
        }
      },
      "additionalProperties": false
    }
  },
  "required": ["defaults"]
}
