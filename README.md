# LLM Markup (LLMPM)

**A Policy, Intent, and Provenance Overlay for HTML**

[![Status: Beta](https://img.shields.io/badge/Status-Beta-yellow.svg)]()
[![License: W3C](https://img.shields.io/badge/License-W3C-blue.svg)](LICENSE)

LLM Markup is a declarative contract between web content authors and **LLM-Infused User Agents**. It provides machine-readable attributes to specify:

- **What the LLM can see** (visibility/input control)
- **What the LLM can change** (mutation/output control)
- **What the LLM can remember** (retention/memory control)
- **How content should be interpreted** (semantic intent)
- **What changes were made** (provenance tracking)

## Quick Start

### Basic Policy Example

```html
<!-- LLM can see and modify this content -->
<article llm-policy-output="content annotation">
  <h1>Welcome to My Blog</h1>
  <p>This paragraph can be edited or annotated by the LLM.</p>
</article>

<!-- LLM cannot see this at all -->
<aside llm-policy-input="none">
  <p>Secret admin notes here.</p>
</aside>

<!-- LLM can see structure but not the actual text -->
<div llm-policy-input="structure">
  <p>Sensitive user data: [will show as REDACTED]</p>
</div>
```

### Intent and Provenance Example

```html
<!-- Semantic guidance for the LLM -->
<blockquote llm-intent-category="quote" llm-intent-importance="high">
  <p>To be or not to be, that is the question.</p>
</blockquote>

<!-- Track the source of content -->
<p llm-provenance-source="https://example.com/article"
   llm-provenance-citation="Smith et al., 2024">
  Referenced content with attribution.
</p>

<!-- Record what modifications were made -->
<p llm-provenance-operation="content:summarized-original-paragraph">
  This is a summary generated by the LLM.
</p>
```

### Global Policy via HTTP Header

```http
LLM-Policy: {
  "defaults": {
    "llm-policy-input": ["structure", "text"],
    "llm-policy-output": ["readonly"],
    "llm-policy-memory": ["none"]
  },
  "constraints": {
    "block-selectors": [".pii", "[data-sensitive]"]
  }
}
```

## Key Concepts

### The Three Namespaces

| Namespace | Purpose | Enforcement |
|-----------|---------|-------------|
| `llm-policy-*` | Hard constraints on visibility, mutation, retention | **User Agent enforced** (deterministic) |
| `llm-intent-*` | Semantic hints and context for the LLM | **Prompt construction** (guidance) |
| `llm-provenance-*` | Audit trail of sources and modifications | **Integrity validation** (accountability) |

### Policy Tokens

**Input (Visibility):**
- `none` - Hidden from LLM entirely
- `structure` - Element tags visible, text redacted
- `text` - Text content visible
- `attributes` - HTML attributes visible
- `media` - Media sources (src, alt) visible
- `all` - Everything visible (default)

**Output (Mutability):**
- `readonly` - No modifications allowed (default)
- `style` - Can modify class/style only
- `annotation` - Can wrap text in inline elements
- `content` - Can modify text content
- `mutable` - Full modification allowed

**Memory (Retention):**
- `none` - Ephemeral only (default)
- `session` - Session-scoped retention
- `user` - User profile storage
- `training` - Model training authorized

### License Enforcement

```html
<!-- CC-BY-ND restricts to readonly + annotation -->
<article llm-policy-license="CC-BY-ND-4.0">
  <p>This content cannot be modified, only annotated.</p>
</article>

<!-- Explicit mutable is intersected with license -->
<article llm-policy-license="CC-BY-ND-4.0" llm-policy-output="mutable">
  <!-- Effective: readonly, annotation (license wins) -->
</article>
```

## Repository Structure

```
/
├── spec/                   # Normative Specification (Bikeshed)
│   └── index.bs            # The formal standard
│
├── explainer/              # Non-normative Documentation
│   ├── index.md            # Problem statement and user stories
│   ├── security-privacy.md # W3C Security & Privacy Questionnaire
│   └── use-cases/          # Detailed scenario walkthroughs
│
├── schemas/                # Machine-readable Definitions
│   ├── json-schema/        # JSON schemas for Global Policy
│   └── webidl/             # WebIDL for DOM interfaces
│
├── examples/               # Reference Implementations
│   ├── basic/              # Simple HTML examples
│   └── complex/            # Full page examples
│
├── tests/                  # Conformance Test Suite
│   └── web-platform-tests/ # WPT-style tests
│
└── namespaces/             # Namespace Documentation
    ├── policy/             # llm-policy-* attributes
    ├── intent/             # llm-intent-* attributes
    └── provenance/         # llm-provenance-* attributes
```

## Development Status

### Beta Milestone (Current)

- [x] Core specification complete
- [x] WebIDL interface definitions
- [x] Shadow DOM policy boundaries
- [x] Global Policy delivery mechanism
- [x] Context representation format
- [x] Provenance diff tracking
- [x] License compatibility matrix
- [x] Conformance test suite (17 test files)
- [x] Security & Privacy questionnaire

### Remaining Work

- [ ] Additional examples
- [ ] Implementation guide for User Agents
- [ ] Polyfill reference implementation
- [ ] Formal W3C submission

## Conformance

The conforming entity is the **User Agent**, not the LLM. The specification defines deterministic behavior that browsers must implement to mediate between content policies and LLM capabilities.

```javascript
// Check if policy is resolved before LLM interaction
if (document.llmPolicyResolved) {
  const context = document.buildLLMContext();
  // context contains filtered, policy-compliant HTML
}

// Check mutation permissions
const violation = element.checkMutationPermission('content');
if (violation === null) {
  // Mutation is allowed
}

// Inspect provenance ledger
const entries = document.llmProvenanceLedger.getEntriesForElement(el);
```

## Links

- [Specification](./spec/index.bs) - Normative technical standard
- [Explainer](./explainer/index.md) - Problem statement and rationale
- [Use Cases](./explainer/use-cases/) - Detailed scenario examples
- [Tests](./tests/web-platform-tests/) - Conformance test suite
- [Security & Privacy](./explainer/security-privacy.md) - W3C questionnaire

## Contributing

See [CONTRIBUTING.md](./CONTRIBUTING.md) for W3C IPR policies and contribution guidelines.

## License

This work is licensed under the [W3C Software and Document License](./LICENSE).
